<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@0,400;1,700" rel="stylesheet">
    <title>Criar Usuários</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
</head>
    <link rel="stylesheet" href="./static/form.css">
</head>
<body>
    <section class="area-result">
        <div class="result">
          <a href="/">
            <img src="https://estatico.amcham.com.br/logo_white.png" alt="Logo">
          </a>
          <!-- Formulário de Login -->
          {% if not session.username %}
            <form action="/login" method="POST" class="search-box1">
              <div class="mb-3">
                <label for="username" class="form-label">Usuário:</label>
                <input type="text" id="username" name="username" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Senha:</label>
                <input type="password" id="password" name="password" class="form-control" required>
              </div>
              <button type="submit" class="btn1 btn-primary">Login</button>
            </form>
            <div>
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <ul class="messages">
                            {% for message in messages %}
                                <li>{{ message }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endwith %}
            </div>
        {% endif %}

      <!-- Seção de pesquisa que será exibida após o login -->
        {% if session.username %}
        <h1>Complete os Dados</h2>
        <form id="completeForm" method="POST" action="/create_user" class="search-box1">
            <div class="form-container">
                <div class="input-group">
                    <p><strong>Matrícula:</strong> <span id="employeeID"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Nome:</strong> <span id="nome"></span></p>
                </div>
                <div class="input-group">    
                    <p><strong>Sobrenome:</strong> <span id="sobrenome"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Data de Nascimento:</strong> <span id="data_nascimento"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Data de Contratação:</strong> <span id="data_contratacao"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Departamento:</strong> <span id="departamento"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Cargo:</strong> <span id="cargo"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Telefone:</strong> <span id="telephoneNumber"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Regional:</strong> <span id="regional"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Cidade:</strong> <span id="physicalDeliveryOfficeName"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Estado:</strong> <span id="st"></span></p>
                </div>
                <div class="input-group">
                    <p><strong>Empresa:</strong> <span id="company"></span></p>
                </div>

            </div>

        <!-- New fields -->
        <div class="input-group">
            <label for="logon">Login:</label>
            <input type="text" id="logon" name="logon"><br><br>
        </div>
        <div class="input-group">
            <label for="password">Senha:</label>
            <input type="text" id="password" name="password"><br><br>
        </div>

        <!-- Hidden inputs to carry over previous data -->
        <input type="hidden" name="employeeID" id="hidden_employeeID">
        <input type="hidden" name="nome" id="hidden_nome">
        <input type="hidden" name="sobrenome" id="hidden_sobrenome">
        <input type="hidden" name="data_nascimento" id="hidden_data_nascimento">
        <input type="hidden" name="data_contratacao" id="hidden_data_contratacao">
        <input type="hidden" name="departamento" id="hidden_departamento">
        <input type="hidden" name="cargo" id="hidden_cargo">
        <input type="hidden" name="telephoneNumber" id="hidden_telephoneNumber">
        <input type="hidden" name="regional" id="hidden_regional">
        <input type="hidden" name="physicalDeliveryOfficeName" id="hidden_physicalDeliveryOfficeName">
        <input type="hidden" name="st" id="hidden_st">
        <input type="hidden" name="company" id="hidden_company">
        <input type="hidden" name="logon_sAMAccountName" id="hidden_logon_sAMAccountName">
        <input type="hidden" name="logon_email" id="hidden_logon_email">

        <button type="submit">Criar</button>
    </form>
    <div class="flash-messages">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <ul class="messages">
              {% for message in messages %}
                <li>{{ message }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}
      </div>
    {% endif %}
  </div>
</section>

    <script>
        document.getElementById('logon').addEventListener('input', function() {
            var logonName = this.value;
            var emailDomain = '@amchambrasil.com.br';
            document.getElementById('hidden_logon_sAMAccountName').value = logonName;
            document.getElementById('hidden_logon_email').value = logonName + emailDomain;
        });

        // Function to get query parameters from URL
        function getQueryParams() {
            const params = {};
            window.location.search.substring(1).split("&").forEach(function(pair) {
                const [key, value] = pair.split("=");
                params[decodeURIComponent(key)] = decodeURIComponent(value);
            });
            return params;
        }

        // Populate form with query parameters
        window.onload = function() {
            const params = getQueryParams();
            document.getElementById('employeeID').innerText = params.employeeID;
            document.getElementById('nome').innerText = params.nome;
            document.getElementById('sobrenome').innerText = params.sobrenome;
            document.getElementById('data_nascimento').innerText = params.data_nascimento;
            document.getElementById('data_contratacao').innerText = params.data_contratacao;
            document.getElementById('departamento').innerText = params.departamento;
            document.getElementById('cargo').innerText = params.cargo;
            document.getElementById('telephoneNumber').innerText = params.telephoneNumber;
            document.getElementById('regional').innerText = params.regional;
            document.getElementById('physicalDeliveryOfficeName').innerText = params.physicalDeliveryOfficeName;
            document.getElementById('st').innerText = params.st;
            document.getElementById('company').innerText = params.company;

            // Set hidden inputs
            document.getElementById('hidden_employeeID').value = params.employeeID;
            document.getElementById('hidden_nome').value = params.nome;
            document.getElementById('hidden_sobrenome').value = params.sobrenome;
            document.getElementById('hidden_data_nascimento').value = params.data_nascimento;
            document.getElementById('hidden_data_contratacao').value = params.data_contratacao;
            document.getElementById('hidden_departamento').value = params.departamento;
            document.getElementById('hidden_cargo').value = params.cargo;
            document.getElementById('hidden_telephoneNumber').value = params.telephoneNumber;
            document.getElementById('hidden_regional').value = params.regional;
            document.getElementById('hidden_physicalDeliveryOfficeName').value = params.physicalDeliveryOfficeName;
            document.getElementById('hidden_st').value = params.st;
            document.getElementById('hidden_company').value = params.company;
        };
    </script>
</body>
</html>
